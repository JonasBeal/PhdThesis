
# Clinical evidence generation and causal inference

```{r, include=knitr::is_latex_output(), echo=FALSE}
knitr::asis_output('\\epigraph{"Maudit\n
soit le père de l\'épouse\n
du forgeron qui forgea le fer de la cognée\n
avec laquelle le bûcheron abattit le chêne\n
dans lequel on sculpta le lit\n
où fut engendré l\'arrière-grand-père\n
de l\'homme qui conduisit la voiture\n
dans laquelle ta mère\n
rencontra ton père!"}{Robert Desnos (La colombe de l\'arche, 1923)}')
```

```{r, include=knitr::is_html_output(), echo=FALSE}
knitr::asis_output(
  '>*Maudit  
  >soit le père de l\'épouse  
  >du forgeron qui forgea le fer de la cognée  
  >avec laquelle le bûcheron abattit le chêne  
  >dans lequel on sculpta le lit  
  >où fut engendré l\'arrière-grand-père  
  >de l\'homme qui conduisit la voiture  
  Wdans laquelle ta mère  
  >rencontra ton père!.*<br/>
  >Robert Desnos (La colombe de l\'arche, 1923)')
```

```{r, include=knitr::is_latex_output(), echo=FALSE}
knitr::asis_output('\\initial{T}he previous chapter proposed some tools to evaluate and quantify the value of mechanistic models, and in particular their outputs, with simple statistical tools. The latter, such as $R2$, are by no means specific to medical applications. One of the particularities of mechanistic cancer models, on the other hand, is the possibility of simulating treatments that imitate therapeutic interventions. Before tackling more precise questions, this chapter will therefore introduce certain clinical or statistical methods used to evaluate the effect of different types of treatments, including drugs, on patoents. A more specific issue related to the evaluation of mechanistic models will be explored in the next chapter using these methods')
```

```{r, include=knitr::is_html_output(), echo=FALSE}
knitr::asis_output('The previous chapter proposed some tools to evaluate and quantify the value of mechanistic models, and in particular their outputs, with simple statistical tools. The latter, such as $R2$, are by no means specific to medical applications. One of the particularities of mechanistic cancer models, on the other hand, is the possibility of simulating treatments that imitate therapeutic interventions. Before tackling more precise questions, this chapter will therefore introduce certain clinical or statistical methods used to evaluate the effect of different types of treatments, including drugs, on patoents. A more specific issue related to the evaluation of mechanistic models will be explored in the next chapter using these methods.')
```

```{r 8_packages, echo=FALSE, warning=FALSE, message=FALSE}
invisible(lapply(X =  c("knitr", "tidyverse", "magrittr",  "ggplot2", "ggpubr", "patchwork", "cowplot"),
       FUN = require,
       character.only = TRUE))

knitr::opts_chunk$set(
  cache = TRUE, echo = FALSE, warning = FALSE, message = FALSE,
  out.width = "90%",
  #fig.pos = "ht",
  fig.align = "center"
  )
```
  

```{block2, type='summarybox', echo = TRUE}

#### Scientific content {-}

This short chapter introduces the framework for causal inference based on the literature and the description of causal inference in @beal2020causal.

```

\newcommand{\indep}{\perp \!\!\! \perp}

## Clinical trials and observational data

### Randomized clinical trials as gold standards

```{r trials, echo=FALSE, out.width = "90%", fig.cap='(ref:trials-caption)', fig.scap='Bimodality criteria and their combinations', fig.align='center'}
knitr::include_graphics("fig/trials.png")
```
(ref:trials-caption) **Principles of randomized clinical trials**. This trial evaluates the impact 

### Dangers and opportunities of observational data

## Causal inference methods to leverage data

Now that we have defined what we want to estimate, we need to specify the method of estimation. In cases where it would be too difficult or too early to conduct a true clinical trial we propose methods using observational data to emulate them. Indeed, it is possible to derive estimates with a causal interpretation from observational data in the context of the potential outcomes framework [@rubin1974estimating]. We will first describe briefly the fundamentals of this framework..

### First notations and causal graph

We will use $j=1,...,N$ to index the individuals in the population. $A_j$ and $Y_j$ correspond respectively to the actual treatment received by individual $j$ and the outcome. In the most simple case, treatment takes values in $\mathcal{A}=\{0, 1\}$, $1$ denoting the treated patients and $0$ the control ones. $Y_j$ corresponds to the patient's response to treatment. In the case of cancer it may be  a continuous value (e.g size of tumour), a binary value (e.g status or event indicator), or even a time-to-event (e.g time to relapse or death). Only the first two cases will be discussed later. Finally, it is necessary to take into account the possible presence of confounders influencing both $A$ and $Y$ and denoted $C_j$ for individual $j$.


### Potential outcomes framework

One standard framework to estimate causal effects relies on potential outcomes [@rubin1974estimating]. This framework is sometimes described as counterfactual because it defines variables like $Y_j(a)$ to denote the potential outcome of individual $j$ in case he has been treated by $A=a$ which may be different from what we observe if $A_j\neq a$. These counterfactual variables make it possible to write the causal estimands. For instance, in this context, we can easily compute the difference in outcome between treated patients and control patients: 
$E[Y | A=1] - E[Y | A=0].$

However, this difference has no causal interpretation as it does not offer any guarantees as to the confounding factor, as an unbalanced distribution of $C$ can induce biases Thus we define another estimate:
$E[Y(1)] - E[Y(0)].$

In this case, we compare between two ideal cohort, one in which all patients have been treated (possibly contrary to the fact) and one in which all patients have been left in the control arm (once again, possibly contrary to the fact). Under certain assumptions of consistency, positivity and conditional exchangeability, the potential outcomes framework allows to estimate these counterfactual variables and therefore infer causal estimates from observational (non-randomized) data [@rubin1974estimating, @hernan2020causal]. 

*Consistency* means that values of treatment under comparison represent well-defined interventions which themselves correspond to the treatments in the data:
$\textrm{if} \: A_j=a,  \textrm{then} \: Y_j(a)=Y_j.$

*Exchangeability* means that treated and control patients are exchangeable, i.e if the treated patients had not been treated they would have had the same outcomes as the controls, and conversely. Since we usually observe some confounders we define conditional exchangeability to hold if cohorts are exchangeable for same values of confounding $C$. Therefore conditional exchangeability will hold if there are no unmeasured confounding:
$Y(a) \indep A | C.$

*Positivity* assumption states that the probability of being administered a certain version of treatment conditional on $C$ is greater than zero:
$\textrm{if} \: P[C=c] \neq 0, P[A=a | C=c] >0.$
Intuitively, this positivity condition is required to ensure that the defined counterfactual variables make sense and do not represent something that cannot exist.

### Identification of causal effects

Different methods provide estimators to evaluate causal effect from observational data. Throughout the article, we will describe essentially one method called standardization or parametric g-formula. Details on other types of estimators are available in Supplementary Materials, sections B and C. In this simple case (Figure~\ref{fig2_DAG_single}), the causal effect of treatment $A$ can be written with standardized means (formal proof in Supplementary Materials, section A):

$$
E[Y(A=1)] - E[Y(A=0)] = \sum_{c} \Big(E[Y | A=1, C=c]-E[Y | A=0, C=c]\Big) \times P[C=c].
$$

Computationally, non-parametric estimation of $E[Y | A=a, C=c]$ is usually out of reach. Thus, on real-world dataset, $E[Y | A=a, C=c]$ is estimated through modelling and explicit computation $P[C=c]$ is replaced by its empirical estimate.

